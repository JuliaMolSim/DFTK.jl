<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Problems and plane-wave discretisations · DFTK.jl</title><meta name="title" content="Problems and plane-wave discretisations · DFTK.jl"/><meta property="og:title" content="Problems and plane-wave discretisations · DFTK.jl"/><meta property="twitter:title" content="Problems and plane-wave discretisations · DFTK.jl"/><meta name="description" content="Documentation for DFTK.jl."/><meta property="og:description" content="Documentation for DFTK.jl."/><meta property="twitter:description" content="Documentation for DFTK.jl."/><meta property="og:url" content="https://docs.dftk.org/stable/guide/periodic_problems/"/><meta property="twitter:url" content="https://docs.dftk.org/stable/guide/periodic_problems/"/><link rel="canonical" href="https://docs.dftk.org/stable/guide/periodic_problems/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DFTK.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DFTK.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../features/">DFTK features</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li class="is-active"><a class="tocitem" href>Problems and plane-wave discretisations</a><ul class="internal"><li><a class="tocitem" href="#Periodicity-and-lattices"><span>Periodicity and lattices</span></a></li><li><a class="tocitem" href="#Periodic-operators-and-the-Bloch-transform"><span>Periodic operators and the Bloch transform</span></a></li><li><a class="tocitem" href="#The-Brillouin-zone"><span>The Brillouin zone</span></a></li><li><a class="tocitem" href="#Discretization-and-plane-wave-basis-sets"><span>Discretization and plane-wave basis sets</span></a></li><li><a class="tocitem" href="#Correspondence-of-theory-to-DFTK-code"><span>Correspondence of theory to DFTK code</span></a></li><li><a class="tocitem" href="#Solving-the-free-electron-Hamiltonian"><span>Solving the free-electron Hamiltonian</span></a></li><li><a class="tocitem" href="#Adding-potentials"><span>Adding potentials</span></a></li></ul></li><li><a class="tocitem" href="../introductory_resources/">Introductory resources</a></li><li><a class="tocitem" href="../../school2022/">DFTK School 2022</a></li></ul></li><li><span class="tocitem">Basic DFT calculations</span><ul><li><a class="tocitem" href="../../examples/metallic_systems/">Temperature and metallic systems</a></li><li><a class="tocitem" href="../../examples/collinear_magnetism/">Collinear spin and magnetic systems</a></li><li><a class="tocitem" href="../../examples/convergence_study/">Performing a convergence study</a></li><li><a class="tocitem" href="../../examples/pseudopotentials/">Pseudopotentials</a></li><li><a class="tocitem" href="../../examples/supercells/">Creating and modelling metallic supercells</a></li><li><a class="tocitem" href="../../examples/gaas_surface/">Modelling a gallium arsenide surface</a></li><li><a class="tocitem" href="../../examples/graphene/">Graphene band structure</a></li><li><a class="tocitem" href="../../examples/geometry_optimization/">Geometry optimization</a></li><li><a class="tocitem" href="../../examples/energy_cutoff_smearing/">Energy cutoff smearing</a></li></ul></li><li><span class="tocitem">Response and properties</span><ul><li><a class="tocitem" href="../../examples/polarizability/">Polarizability by linear response</a></li><li><a class="tocitem" href="../../examples/forwarddiff/">Polarizability using automatic differentiation</a></li><li><a class="tocitem" href="../../examples/dielectric/">Eigenvalues of the dielectric matrix</a></li></ul></li><li><span class="tocitem">Ecosystem integration</span><ul><li><a class="tocitem" href="../../examples/atomsbase/">AtomsBase integration</a></li><li><a class="tocitem" href="../../examples/input_output/">Input and output formats</a></li><li><a class="tocitem" href="../../examples/wannier/">Wannierization using Wannier.jl or Wannier90</a></li></ul></li><li><span class="tocitem">Tipps and tricks</span><ul><li><a class="tocitem" href="../../tricks/parallelization/">Timings and parallelization</a></li><li><a class="tocitem" href="../../tricks/scf_checkpoints/">Saving SCF results on disk and SCF checkpoints</a></li></ul></li><li><span class="tocitem">Solvers</span><ul><li><a class="tocitem" href="../../examples/custom_solvers/">Custom solvers</a></li><li><a class="tocitem" href="../../examples/scf_callbacks/">Monitoring self-consistent field calculations</a></li><li><a class="tocitem" href="../../examples/compare_solvers/">Comparison of DFT solvers</a></li></ul></li><li><span class="tocitem">Nonstandard models</span><ul><li><a class="tocitem" href="../../examples/gross_pitaevskii/">Gross-Pitaevskii equation in one dimension</a></li><li><a class="tocitem" href="../../examples/gross_pitaevskii_2D/">Gross-Pitaevskii equation with external magnetic field</a></li><li><a class="tocitem" href="../../examples/custom_potential/">Custom potential</a></li><li><a class="tocitem" href="../../examples/cohen_bergstresser/">Cohen-Bergstresser model</a></li><li><a class="tocitem" href="../../examples/anyons/">Anyonic models</a></li></ul></li><li><span class="tocitem">Error control</span><ul><li><a class="tocitem" href="../../examples/arbitrary_floattype/">Arbitrary floating-point types</a></li><li><a class="tocitem" href="../../examples/error_estimates_forces/">Practical error bounds for the forces</a></li></ul></li><li><span class="tocitem">Developer resources</span><ul><li><a class="tocitem" href="../../developer/setup/">Developer setup</a></li><li><a class="tocitem" href="../../developer/conventions/">Notation and conventions</a></li><li><a class="tocitem" href="../../developer/data_structures/">Data structures</a></li><li><a class="tocitem" href="../../developer/useful_formulas/">Useful formulas</a></li><li><a class="tocitem" href="../../developer/symmetries/">Crystal symmetries</a></li><li><a class="tocitem" href="../../developer/gpu_computations/">GPU computations</a></li></ul></li><li><a class="tocitem" href="../../api/">API reference</a></li><li><a class="tocitem" href="../../publications/">Publications</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Getting started</a></li><li class="is-active"><a href>Problems and plane-wave discretisations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Problems and plane-wave discretisations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaMolSim/DFTK.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaMolSim/DFTK.jl/blob/master/docs/src/guide/periodic_problems.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="periodic-problems"><a class="docs-heading-anchor" href="#periodic-problems">Problems and plane-wave discretisations</a><a id="periodic-problems-1"></a><a class="docs-heading-anchor-permalink" href="#periodic-problems" title="Permalink"></a></h1><p><a href="https://mybinder.org/v2/gh/JuliaMolSim/DFTK.jl/gh-pages?filepath=v0.6.16/guide/periodic_problems.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/JuliaMolSim/DFTK.jl/blob/gh-pages/v0.6.16/guide/periodic_problems.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><p>In this example we want to show how DFTK can be used to solve simple one-dimensional periodic problems. Along the lines this notebook serves as a concise introduction into the underlying theory and jargon for solving periodic problems using plane-wave discretizations.</p><h2 id="Periodicity-and-lattices"><a class="docs-heading-anchor" href="#Periodicity-and-lattices">Periodicity and lattices</a><a id="Periodicity-and-lattices-1"></a><a class="docs-heading-anchor-permalink" href="#Periodicity-and-lattices" title="Permalink"></a></h2><p>A periodic problem is characterized by being invariant to certain translations. For example the <span>$\sin$</span> function is periodic with periodicity <span>$2π$</span>, i.e.</p><p class="math-container">\[   \sin(x) = \sin(x + 2πm) \quad ∀ m ∈ \mathbb{Z},\]</p><p>This is nothing else than saying that any translation by an integer multiple of <span>$2π$</span> keeps the <span>$\sin$</span> function invariant. More formally, one can use the translation operator <span>$T_{2πm}$</span> to write this as:</p><p class="math-container">\[   T_{2πm} \, \sin(x) = \sin(x - 2πm) = \sin(x).\]</p><p>Whenever such periodicity exists one can exploit it to save computational work. Consider a problem in which we want to find a function <span>$f : \mathbb{R} → \mathbb{R}$</span>, but <em>a priori</em> the solution is known to be periodic with periodicity <span>$a$</span>. As a consequence of said periodicity it is sufficient to determine the values of <span>$f$</span> for all <span>$x$</span> from the interval <span>$[-a/2, a/2)$</span> to uniquely define <span>$f$</span> on the full real axis. Naturally exploiting periodicity in a computational procedure thus greatly reduces the required amount of work.</p><p>Let us introduce some jargon: The periodicity of our problem implies that we may define a <strong>lattice</strong></p><pre><code class="nohighlight hljs">        -3a/2      -a/2      +a/2     +3a/2
       ... |---------|---------|---------| ...
                a         a         a</code></pre><p>with lattice constant <span>$a$</span>. Each cell of the lattice is an identical periodic image of any of its neighbors. For finding <span>$f$</span> it is thus sufficient to consider only the problem inside a <strong>unit cell</strong> <span>$[-a/2, a/2)$</span> (this is the convention used by DFTK, but this is arbitrary, and for instance <span>$[0,a)$</span> would have worked just as well).</p><h2 id="Periodic-operators-and-the-Bloch-transform"><a class="docs-heading-anchor" href="#Periodic-operators-and-the-Bloch-transform">Periodic operators and the Bloch transform</a><a id="Periodic-operators-and-the-Bloch-transform-1"></a><a class="docs-heading-anchor-permalink" href="#Periodic-operators-and-the-Bloch-transform" title="Permalink"></a></h2><p>Not only functions, but also operators can feature periodicity. Consider for example the <strong>free-electron Hamiltonian</strong></p><p class="math-container">\[    H = -\frac12 Δ.\]</p><p>In free-electron model (which gives rise to this Hamiltonian) electron motion is only by their own kinetic energy. As this model features no potential which could make one point in space more preferred than another, we would expect this model to be periodic. If an operator is periodic with respect to a lattice such as the one defined above, then it commutes with all lattice translations. For the free-electron case <span>$H$</span> one can easily show exactly that, i.e.</p><p class="math-container">\[   T_{ma} H = H T_{ma} \quad  ∀ m ∈ \mathbb{Z}.\]</p><p>We note in passing that the free-electron model is actually very special in the sense that the choice of <span>$a$</span> is completely arbitrary here. In other words <span>$H$</span> is periodic with respect to any translation. In general, however, periodicity is only attained with respect to a finite number of translations <span>$a$</span> and we will take this viewpoint here.</p><p><strong>Bloch&#39;s theorem</strong> now tells us that for periodic operators, the solutions to the eigenproblem</p><p class="math-container">\[    H ψ_{kn} = ε_{kn} ψ_{kn}\]</p><p>satisfy a factorization</p><p class="math-container">\[    ψ_{kn}(x) = e^{i k⋅x} u_{kn}(x)\]</p><p>into a plane wave <span>$e^{i k⋅x}$</span> and a lattice-periodic function</p><p class="math-container">\[   T_{ma} u_{kn}(x) = u_{kn}(x - ma) = u_{kn}(x) \quad ∀ m ∈ \mathbb{Z}.\]</p><p>In this <span>$n$</span> is a labeling integer index and <span>$k$</span> is a real number, whose details will be clarified in the next section. The index <span>$n$</span> is sometimes also called the <strong>band index</strong> and functions <span>$ψ_{kn}$</span> satisfying this factorization are also known as <strong>Bloch functions</strong> or <strong>Bloch states</strong>.</p><p>Consider the application of <span>$2H = -Δ = - \frac{d^2}{d x^2}$</span> to such a Bloch wave. First we notice for any function <span>$f$</span></p><p class="math-container">\[   -i∇ \left( e^{i k⋅x} f \right)
   = -i\frac{d}{dx} \left( e^{i k⋅x} f \right)
   = k e^{i k⋅x} f + e^{i k⋅x} (-i∇) f = e^{i k⋅x} (-i∇ + k) f.\]</p><p>Using this result twice one shows that applying <span>$-Δ$</span> yields</p><p class="math-container">\[\begin{aligned}
   -\Delta \left(e^{i k⋅x} u_{kn}(x)\right)
   &amp;= -i∇ ⋅ \left[-i∇ \left(u_{kn}(x) e^{i k⋅x} \right) \right] \\
   &amp;= -i∇ ⋅ \left[e^{i k⋅x} (-i∇ + k) u_{kn}(x) \right] \\
   &amp;= e^{i k⋅x} (-i∇ + k)^2 u_{kn}(x) \\
   &amp;= e^{i k⋅x} 2H_k u_{kn}(x),
\end{aligned}\]</p><p>where we defined</p><p class="math-container">\[    H_k = \frac12 (-i∇ + k)^2.\]</p><p>The action of this operator on a function <span>$u_{kn}$</span> is given by</p><p class="math-container">\[    H_k u_{kn} = e^{-i k⋅x} H e^{i k⋅x} u_{kn},\]</p><p>which in particular implies that</p><p class="math-container">\[   H_k u_{kn} = ε_{kn} u_{kn} \quad ⇔ \quad H (e^{i k⋅x} u_{kn}) = ε_{kn} (e^{i k⋅x} u_{kn}).\]</p><p>To seek the eigenpairs of <span>$H$</span> we may thus equivalently find the eigenpairs of <em>all</em> <span>$H_k$</span>. The point of this is that the eigenfunctions <span>$u_{kn}$</span> of <span>$H_k$</span> are periodic (unlike the eigenfunctions <span>$ψ_{kn}$</span> of <span>$H$</span>). In contrast to <span>$ψ_{kn}$</span> the functions <span>$u_{kn}$</span> can thus be fully represented considering the eigenproblem only on the unit cell.</p><p>A detailed mathematical analysis shows that the transformation from <span>$H$</span> to the set of all <span>$H_k$</span> for a suitable set of values for <span>$k$</span> (details below) is actually a unitary transformation, the so-called <strong>Bloch transform</strong>. This transform brings the Hamiltonian into the symmetry-adapted basis for translational symmetry, which are exactly the Bloch functions. Similar to the case of choosing a symmetry-adapted basis for other kinds of symmetries (like the point group symmetry in molecules), the Bloch transform also makes the Hamiltonian <span>$H$</span> block-diagonal<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>:</p><p class="math-container">\[    T_B H T_B^{-1} ⟶ \left( \begin{array}{cccc} H_1&amp;&amp;&amp;0 \\ &amp;H_2\\&amp;&amp;H_3\\0&amp;&amp;&amp;\ddots \end{array} \right)\]</p><p>with each block <span>$H_k$</span> taking care of one value <span>$k$</span>. This block-diagonal structure under the basis of Bloch functions lets us completely describe the spectrum of <span>$H$</span> by looking only at the spectrum of all <span>$H_k$</span> blocks.</p><h2 id="The-Brillouin-zone"><a class="docs-heading-anchor" href="#The-Brillouin-zone">The Brillouin zone</a><a id="The-Brillouin-zone-1"></a><a class="docs-heading-anchor-permalink" href="#The-Brillouin-zone" title="Permalink"></a></h2><p>We now consider the parameter <span>$k$</span> of the Hamiltonian blocks in detail.</p><ul><li><p>As discussed <span>$k$</span> is a real number. It turns out, however, that some of these <span>$k∈\mathbb{R}$</span> give rise to operators related by unitary transformations (again due to translational symmetry).</p></li><li><p>Since such operators have the same eigenspectrum, only one version needs to be considered.</p></li><li><p>The smallest subset from which <span>$k$</span> is chosen is the <strong>Brillouin zone</strong> (BZ).</p></li><li><p>The BZ is the unit cell of the <strong>reciprocal lattice</strong>, which may be constructed from the <strong>real-space lattice</strong> by a Fourier transform.</p></li><li><p>In our simple 1D case the reciprocal lattice is just</p><pre><code class="nohighlight hljs">  ... |--------|--------|--------| ...
         2π/a     2π/a     2π/a</code></pre><p>i.e. like the real-space lattice, but just with a different lattice constant <span>$b = 2π / a$</span>.</p></li><li><p>The BZ in our example is thus <span>$B = [-π/a, π/a)$</span>. The members of <span>$B$</span> are typically called <span>$k$</span>-points.</p></li></ul><h2 id="Discretization-and-plane-wave-basis-sets"><a class="docs-heading-anchor" href="#Discretization-and-plane-wave-basis-sets">Discretization and plane-wave basis sets</a><a id="Discretization-and-plane-wave-basis-sets-1"></a><a class="docs-heading-anchor-permalink" href="#Discretization-and-plane-wave-basis-sets" title="Permalink"></a></h2><p>With what we discussed so far the strategy to find all eigenpairs of a periodic Hamiltonian <span>$H$</span> thus reduces to finding the eigenpairs of all <span>$H_k$</span> with <span>$k ∈ B$</span>. This requires <em>two</em> discretisations:</p><ul><li><span>$B$</span> is infinite (and not countable). To discretize we first only pick a finite number of <span>$k$</span>-points. Usually this <strong><span>$k$</span>-point sampling</strong> is done by picking <span>$k$</span>-points along a regular grid inside the BZ, the <strong><span>$k$</span>-grid</strong>.</li><li>Each <span>$H_k$</span> is still an infinite-dimensional operator. Following a standard Ritz-Galerkin ansatz we project the operator into a finite basis and diagonalize the resulting matrix.</li></ul><p>For the second step multiple types of bases are used in practice (finite differences, finite elements, Gaussians, ...). In DFTK we currently support only plane-wave discretizations.</p><p>For our 1D example normalized plane waves are defined as the functions</p><p class="math-container">\[e_{G}(x) = \frac{e^{i G x}}{\sqrt{a}}  \qquad G \in b\mathbb{Z}\]</p><p>and typically one forms basis sets from these by specifying a <strong>kinetic energy cutoff</strong> <span>$E_\text{cut}$</span>:</p><p class="math-container">\[\left\{ e_{G} \, \big| \, (G + k)^2 \leq 2E_\text{cut} \right\}\]</p><h2 id="Correspondence-of-theory-to-DFTK-code"><a class="docs-heading-anchor" href="#Correspondence-of-theory-to-DFTK-code">Correspondence of theory to DFTK code</a><a id="Correspondence-of-theory-to-DFTK-code-1"></a><a class="docs-heading-anchor-permalink" href="#Correspondence-of-theory-to-DFTK-code" title="Permalink"></a></h2><p>Before solving a few example problems numerically in DFTK, a short overview of the correspondence of the introduced quantities to data structures inside DFTK.</p><ul><li><span>$H$</span> is represented by a <code>Hamiltonian</code> object and variables for hamiltonians are usually called <code>ham</code>.</li><li><span>$H_k$</span> by a <code>HamiltonianBlock</code> and variables are <code>hamk</code>.</li><li><span>$ψ_{kn}$</span> is usually just called <code>ψ</code>. <span>$u_{kn}$</span> is not stored (in favor of <span>$ψ_{kn}$</span>).</li><li><span>$ε_{kn}$</span> is called <code>eigenvalues</code>.</li><li><span>$k$</span>-points are represented by <code>Kpoint</code> and respective variables called <code>kpt</code>.</li><li>The basis of plane waves is managed by <code>PlaneWaveBasis</code> and variables usually just called <code>basis</code>.</li></ul><h2 id="Solving-the-free-electron-Hamiltonian"><a class="docs-heading-anchor" href="#Solving-the-free-electron-Hamiltonian">Solving the free-electron Hamiltonian</a><a id="Solving-the-free-electron-Hamiltonian-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-free-electron-Hamiltonian" title="Permalink"></a></h2><p>One typical approach to get physical insight into a Hamiltonian <span>$H$</span> is to plot a so-called <strong>band structure</strong>, that is the eigenvalues of <span>$H_k$</span> versus <span>$k$</span>. In DFTK we achieve this using the following steps:</p><p>Step 1: Build the 1D lattice. DFTK is mostly tailored for 3D problems. Therefore quantities related to the problem space are have a fixed dimension 3. The convention is that for 1D / 2D problems the trailing entries are always zero and ignored in the computation. For the lattice we therefore construct a 3x3 matrix with only one entry.</p><pre><code class="language-julia hljs">using DFTK

lattice = zeros(3, 3)
lattice[1, 1] = 20.;</code></pre><p>Step 2: Select a model. In this case we choose a free-electron model, which is the same as saying that there is only a Kinetic term (and no potential) in the model.</p><pre><code class="language-julia hljs">model = Model(lattice; terms=[Kinetic()])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Model(custom, 1D):
    lattice (in Bohr)    : [20        , 0         , 0         ]
                           [0         , 0         , 0         ]
                           [0         , 0         , 0         ]
    unit cell volume     : 20 Bohr

    num. electrons       : 0
    spin polarization    : none
    temperature          : 0 Ha

    terms                : Kinetic()</code></pre><p>Step 3: Define a plane-wave basis using this model and a cutoff <span>$E_\text{cut}$</span> of 300 Hartree. The <span>$k$</span>-point grid is given as a regular grid in the BZ (a so-called <strong>Monkhorst-Pack</strong> grid). Here we select only one <span>$k$</span>-point (1x1x1), see the note below for some details on this choice.</p><pre><code class="language-julia hljs">basis = PlaneWaveBasis(model; Ecut=300, kgrid=(1, 1, 1))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PlaneWaveBasis discretization:
    architecture         : DFTK.CPU()
    num. mpi processes   : 1
    num. julia threads   : 1
    num. blas  threads   : 2
    num. fft   threads   : 1

    Ecut                 : 300.0 Ha
    fft_size             : (320, 1, 1), 320 total points
    kgrid                : MonkhorstPack([1, 1, 1])
    num.   red. kpoints  : 1
    num. irred. kpoints  : 1

    Discretized Model(custom, 1D):
        lattice (in Bohr)    : [20        , 0         , 0         ]
                               [0         , 0         , 0         ]
                               [0         , 0         , 0         ]
        unit cell volume     : 20 Bohr
    
        num. electrons       : 0
        spin polarization    : none
        temperature          : 0 Ha
    
        terms                : Kinetic()</code></pre><p>Step 4: Plot the bands! Select a density of <span>$k$</span>-points for the <span>$k$</span>-grid to use for the bandstructure calculation, discretize the problem and diagonalize it. Afterwards plot the bands.</p><pre><code class="language-julia hljs">using Unitful
using UnitfulAtomic
using Plots

plot_bandstructure(basis; n_bands=6, kline_density=100)</code></pre><img src="2b711f31.svg" alt="Example block output"/><div class="admonition is-info"><header class="admonition-header">Selection of k-point grids in `PlaneWaveBasis` construction</header><div class="admonition-body"><p>You might wonder why we only selected a single <span>$k$</span>-point (clearly a very crude and inaccurate approximation). In this example the <code>kgrid</code> parameter specified in the construction of the <code>PlaneWaveBasis</code> is not actually used for plotting the bands. It is only used when solving more involved models like density-functional theory (DFT) where the Hamiltonian is non-linear. In these cases before plotting the bands the self-consistent field equations (SCF) need to be solved first. This is typically done on a different <span>$k$</span>-point grid than the grid used for the bands later on. In our case we don&#39;t need this extra step and therefore the <code>kgrid</code> value passed to <code>PlaneWaveBasis</code> is actually arbitrary.</p></div></div><h2 id="Adding-potentials"><a class="docs-heading-anchor" href="#Adding-potentials">Adding potentials</a><a id="Adding-potentials-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-potentials" title="Permalink"></a></h2><p>So far so good. But free electrons are actually a little boring, so let&#39;s add a potential interacting with the electrons.</p><ul><li><p>The modified problem we will look at consists of diagonalizing</p><p class="math-container">\[H_k = \frac12 (-i \nabla + k)^2 + V\]</p><p>for all <span>$k \in B$</span> with a periodic potential <span>$V$</span> interacting with the electrons.</p></li><li><p>A number of &quot;standard&quot; potentials are readily implemented in DFTK and can be assembled using the <code>terms</code> kwarg of the model. This allows to seamlessly construct</p><ul><li>density-functial theory (DFT) models for treating electronic structures (see the <a href="../tutorial/#Tutorial">Tutorial</a>).</li><li>Gross-Pitaevskii models for bosonic systems (see <a href="../../examples/gross_pitaevskii/#gross-pitaevskii">Gross-Pitaevskii equation in one dimension</a>)</li><li>even some more unusual cases like anyonic models.</li></ul></li></ul><p>We will use <code>ElementGaussian</code>, which is an analytic potential describing a Gaussian interaction with the electrons to DFTK. See <a href="../../examples/custom_potential/#custom-potential">Custom potential</a> for how to create a custom potential.</p><p>A single potential looks like:</p><pre><code class="language-julia hljs">using Plots
using LinearAlgebra
nucleus = ElementGaussian(0.3, 10.0)
plot(r -&gt; DFTK.local_potential_real(nucleus, norm(r)), xlims=(-50, 50))</code></pre><img src="0c690b29.svg" alt="Example block output"/><p>With this element at hand we can easily construct a setting where two potentials of this form are located at positions <span>$20$</span> and <span>$80$</span> inside the lattice <span>$[0, 100]$</span>:</p><pre><code class="language-julia hljs">using LinearAlgebra

# Define the 1D lattice [0, 100]
lattice = diagm([100., 0, 0])

# Place them at 20 and 80 in *fractional coordinates*,
# that is 0.2 and 0.8, since the lattice is 100 wide.
nucleus   = ElementGaussian(0.3, 10.0)
atoms     = [nucleus, nucleus]
positions = [[0.2, 0, 0], [0.8, 0, 0]]

# Assemble the model, discretize and build the Hamiltonian
model = Model(lattice, atoms, positions; terms=[Kinetic(), AtomicLocal()])
basis = PlaneWaveBasis(model; Ecut=300, kgrid=(1, 1, 1));
ham   = Hamiltonian(basis)

# Extract the total potential term of the Hamiltonian and plot it
potential = DFTK.total_local_potential(ham)[:, 1, 1]
rvecs = collect(r_vectors_cart(basis))[:, 1, 1]  # slice along the x axis
x = [r[1] for r in rvecs]                        # only keep the x coordinate
plot(x, potential, label=&quot;&quot;, xlabel=&quot;x&quot;, ylabel=&quot;V(x)&quot;)</code></pre><img src="ad9229ab.svg" alt="Example block output"/><p>This potential is the sum of two &quot;atomic&quot; potentials (the two &quot;Gaussian&quot; elements). Due to the periodic setting we are considering interactions naturally also occur across the unit cell boundary (i.e. wrapping from <code>100</code> over to <code>0</code>). The required periodization of the atomic potential is automatically taken care, such that the potential is smooth across the cell boundary at <code>100</code>/<code>0</code>.</p><p>With this setup, let&#39;s look at the bands:</p><pre><code class="language-julia hljs">using Unitful
using UnitfulAtomic

plot_bandstructure(basis; n_bands=6, kline_density=500)</code></pre><img src="c12bcd7b.svg" alt="Example block output"/><p>The bands are noticeably different.</p><ul><li><p>The bands no longer overlap, meaning that the spectrum of <span>$H$</span> is no longer continuous but has gaps.</p></li><li><p>The two lowest bands are almost flat. This is because they represent two tightly bound and localized electrons inside the two Gaussians.</p></li><li><p>The higher the bands are in energy, the more free-electron-like they are. In other words the higher the kinetic energy of the electrons, the less they feel the effect of the two Gaussian potentials. As it turns out the curvature of the bands, (the degree to which they are free-electron-like) is highly related to the delocalization of electrons in these bands: The more curved the more delocalized. In some sense &quot;free electrons&quot; correspond to perfect delocalization.</p></li></ul><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Notice that block-diagonal is a bit an abuse of terms here, since the Hamiltonian   is not a matrix but an operator and the number of blocks is infinite.   The mathematically precise term is that the Bloch transform reveals the fibers   of the Hamiltonian.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tutorial/">« Tutorial</a><a class="docs-footer-nextpage" href="../introductory_resources/">Introductory resources »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Tuesday 26 December 2023 11:28">Tuesday 26 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
