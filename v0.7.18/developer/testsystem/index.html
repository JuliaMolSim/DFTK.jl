<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Unit test system · DFTK.jl</title><meta name="title" content="Unit test system · DFTK.jl"/><meta property="og:title" content="Unit test system · DFTK.jl"/><meta property="twitter:title" content="Unit test system · DFTK.jl"/><meta name="description" content="Documentation for DFTK.jl."/><meta property="og:description" content="Documentation for DFTK.jl."/><meta property="twitter:description" content="Documentation for DFTK.jl."/><meta property="og:url" content="https://docs.dftk.org/stable/developer/testsystem/"/><meta property="twitter:url" content="https://docs.dftk.org/stable/developer/testsystem/"/><link rel="canonical" href="https://docs.dftk.org/stable/developer/testsystem/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DFTK.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DFTK.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../features/">DFTK features</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="../../guide/installation/">Installation</a></li><li><a class="tocitem" href="../../guide/tutorial/">Tutorial</a></li></ul></li><li><span class="tocitem">Background</span><ul><li><a class="tocitem" href="../../guide/introductory_resources/">Introductory resources</a></li><li><a class="tocitem" href="../../guide/periodic_problems/">Periodic problems and plane-wave discretisations</a></li><li><a class="tocitem" href="../../guide/discretisation/">Comparing discretization techniques</a></li><li><a class="tocitem" href="../../guide/atomic_chains/">Modelling atomic chains</a></li><li><a class="tocitem" href="../../guide/density_functional_theory/">Introduction to density-functional theory</a></li><li><a class="tocitem" href="../../guide/self_consistent_field/">Self-consistent field methods</a></li><li><a class="tocitem" href="../../school2022/">DFTK School 2022</a></li></ul></li><li><span class="tocitem">Basic DFT calculations</span><ul><li><a class="tocitem" href="../../examples/metallic_systems/">Temperature and metallic systems</a></li><li><a class="tocitem" href="../../examples/collinear_magnetism/">Collinear spin and magnetic systems</a></li><li><a class="tocitem" href="../../examples/convergence_study/">Performing a convergence study</a></li><li><a class="tocitem" href="../../examples/pseudopotentials/">Pseudopotentials</a></li><li><a class="tocitem" href="../../examples/supercells/">Creating and modelling metallic supercells</a></li><li><a class="tocitem" href="../../examples/gaas_surface/">Modelling a gallium arsenide surface</a></li><li><a class="tocitem" href="../../examples/graphene/">Graphene band structure</a></li><li><a class="tocitem" href="../../examples/geometry_optimization/">Geometry optimization</a></li><li><a class="tocitem" href="../../examples/energy_cutoff_smearing/">Energy cutoff smearing</a></li></ul></li><li><span class="tocitem">Response and properties</span><ul><li><a class="tocitem" href="../../examples/elastic_constants/">Elastic constants</a></li><li><a class="tocitem" href="../../examples/polarizability/">Polarizability by linear response</a></li><li><a class="tocitem" href="../../examples/forwarddiff/">Polarizability using automatic differentiation</a></li><li><a class="tocitem" href="../../examples/phonons/">Phonon computations</a></li></ul></li><li><span class="tocitem">Ecosystem integration</span><ul><li><a class="tocitem" href="../../ecosystem/atomsbase/">AtomsBase integration</a></li><li><a class="tocitem" href="../../ecosystem/atomscalculators/">AtomsCalculators integration</a></li><li><a class="tocitem" href="../../ecosystem/input_output/">Input and output formats</a></li><li><a class="tocitem" href="../../ecosystem/atomistic_simulation_environment/">Atomistic simulation environment (ASE)</a></li><li><a class="tocitem" href="../../ecosystem/wannier/">Wannierization using Wannier.jl or Wannier90</a></li></ul></li><li><span class="tocitem">Tips and tricks</span><ul><li><a class="tocitem" href="../../tricks/achieving_convergence/">Achieving DFT convergence</a></li><li><a class="tocitem" href="../../tricks/parallelization/">Timings and parallelization</a></li><li><a class="tocitem" href="../../tricks/gpu/">Using DFTK on GPUs</a></li><li><a class="tocitem" href="../../tricks/scf_checkpoints/">Saving SCF results on disk and SCF checkpoints</a></li><li><a class="tocitem" href="../../tricks/compute_clusters/">Using DFTK on compute clusters</a></li></ul></li><li><span class="tocitem">Solvers</span><ul><li><a class="tocitem" href="../../examples/custom_solvers/">Custom solvers</a></li><li><a class="tocitem" href="../../examples/scf_callbacks/">Monitoring self-consistent field calculations</a></li><li><a class="tocitem" href="../../examples/compare_solvers/">Comparison of DFT solvers</a></li><li><a class="tocitem" href="../../examples/analysing_scf_convergence/">Analysing SCF convergence</a></li></ul></li><li><span class="tocitem">Nonstandard models</span><ul><li><a class="tocitem" href="../../examples/gross_pitaevskii/">Gross-Pitaevskii equation in one dimension</a></li><li><a class="tocitem" href="../../examples/gross_pitaevskii_2D/">Gross-Pitaevskii equation with external magnetic field</a></li><li><a class="tocitem" href="../../examples/custom_potential/">Custom potential</a></li><li><a class="tocitem" href="../../examples/cohen_bergstresser/">Cohen-Bergstresser model</a></li><li><a class="tocitem" href="../../examples/anyons/">Anyonic models</a></li></ul></li><li><span class="tocitem">Error control</span><ul><li><a class="tocitem" href="../../examples/arbitrary_floattype/">Arbitrary floating-point types</a></li><li><a class="tocitem" href="../../examples/error_estimates_forces/">Practical error bounds for the forces</a></li></ul></li><li><span class="tocitem">Developer resources</span><ul><li><a class="tocitem" href="../setup/">Developer setup</a></li><li class="is-active"><a class="tocitem" href>Unit test system</a><ul class="internal"><li><a class="tocitem" href="#Running-tests-by-tags"><span>Running tests by tags</span></a></li><li><a class="tocitem" href="#Test-driven-development"><span>Test-driven development</span></a></li><li><a class="tocitem" href="#Developing-unit-tests"><span>Developing unit tests</span></a></li></ul></li><li><a class="tocitem" href="../conventions/">Notation and conventions</a></li><li><a class="tocitem" href="../style_guide/">Developer&#39;s style guide</a></li><li><a class="tocitem" href="../data_structures/">Data structures</a></li><li><a class="tocitem" href="../useful_formulas/">Useful formulas</a></li><li><a class="tocitem" href="../symmetries/">Crystal symmetries</a></li><li><a class="tocitem" href="../gpu_computations/">GPU computations</a></li></ul></li><li><a class="tocitem" href="../../api/">API reference</a></li><li><a class="tocitem" href="../../publications/">Publications</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer resources</a></li><li class="is-active"><a href>Unit test system</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Unit test system</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaMolSim/DFTK.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaMolSim/DFTK.jl/blob/master/docs/src/developer/testsystem.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Unit-test-system"><a class="docs-heading-anchor" href="#Unit-test-system">Unit test system</a><a id="Unit-test-system-1"></a><a class="docs-heading-anchor-permalink" href="#Unit-test-system" title="Permalink"></a></h1><p>This document gives some details how to run and develop unit tests for DFTK.</p><p>We use <a href="https://github.com/julia-vscode/TestItemRunner.jl">TestItemRunner</a> to manage the tests. It reduces the risk to have undefined behavior by preventing tests from being run in global scope. Moreover, it allows for greater flexibility by providing ways to launch a specific subset of the tests. </p><h2 id="Running-tests-by-tags"><a class="docs-heading-anchor" href="#Running-tests-by-tags">Running tests by tags</a><a id="Running-tests-by-tags-1"></a><a class="docs-heading-anchor-permalink" href="#Running-tests-by-tags" title="Permalink"></a></h2><p>To only run a minimal set of tests designed to ensure DFTK functionality (tests tagged with <code>:minimal</code>), one can simply run</p><pre><code class="language-julia hljs">using Pkg
Pkg.test(&quot;DFTK&quot;; test_args = [&quot;minimal&quot;])</code></pre><p>If no <code>test_args</code> are given, all tests are run. Specifying any subset implicitly turns off all tests not tagged accordingly. Multiple tags can be specified at once. For example,</p><pre><code class="language-julia hljs">using Pkg
Pkg.test(&quot;DFTK&quot;; test_args = [&quot;forces&quot;, &quot;example&quot;])</code></pre><p>will test forces and run the examples. It is also possible to disable certain tests:</p><pre><code class="language-julia hljs">using Pkg
Pkg.test(&quot;DFTK&quot;; test_args = [&quot;noslow&quot;])</code></pre><p>will ignore any test tagged as <code>:slow</code>. Finally, parallel tests can be run by passing <code>&quot;mpi&quot;</code> to the <code>test_args</code> keyword argument. GPU tests are triggered with the <code>&quot;gpu&quot;</code> tag.</p><h2 id="Test-driven-development"><a class="docs-heading-anchor" href="#Test-driven-development">Test-driven development</a><a id="Test-driven-development-1"></a><a class="docs-heading-anchor-permalink" href="#Test-driven-development" title="Permalink"></a></h2><p>Oftentimes you want to iterate on either a test, or the corresponding code being tested. Running <code>Pkg.test</code> will instantiate a new test environment, precompile DFTK, etc... every single time. It should thus be avoided for quick iteration.</p><p>Instead, a workflow that works well is the following:</p><ol><li>Ensure that you have Revise.jl and TestEnv.jl installed in your default environment.</li><li>Start the REPL in the DFTK directory, with the <code>--project</code> flag to activate the DFTK project.</li><li>Run <code>using TestEnv, Revise</code> (if they are not already in your <code>startup.jl</code> file).</li><li>Setup an environment with the DFTK test dependencies: <code>TestEnv.activate()</code>.</li><li>Run a specific test by name using TestItemRunner, for example:<pre><code class="language-jl hljs">using TestItemRunner
TestItemRunner.run_tests(&quot;test/&quot;, filter=ti-&gt;ti.name==&quot;Hamiltonian consistency&quot;)</code></pre>This runs the test item with the name <code>Hamiltonian consistency</code>, i.e. declared in code as <code>@testitem &quot;Hamiltonian consistency&quot; ...</code>.</li><li>Modify either DFTK or test code, and call <code>run_tests</code> again as many times as necessary. Revise will ensure that changes to DFTK will be picked up.</li></ol><h3 id="Other-filters"><a class="docs-heading-anchor" href="#Other-filters">Other filters</a><a id="Other-filters-1"></a><a class="docs-heading-anchor-permalink" href="#Other-filters" title="Permalink"></a></h3><p>TestItemRunner also supports selection by a file name. For example, to run all tests in a unit test file named <code>serialisation.jl</code>:</p><pre><code class="language-julia hljs">TestItemRunner.run_tests(&quot;test/&quot;, filter=ti-&gt;occursin(&quot;serialisation.jl&quot;, ti.filename))</code></pre><p>As the above syntax suggests filters can be more general, using the <code>ti.filename</code>, <code>ti.name</code> and/or <code>ti.tags</code> fields passed to the filter.</p><h2 id="Developing-unit-tests"><a class="docs-heading-anchor" href="#Developing-unit-tests">Developing unit tests</a><a id="Developing-unit-tests-1"></a><a class="docs-heading-anchor-permalink" href="#Developing-unit-tests" title="Permalink"></a></h2><p>If you need to write tests, note that you can create modules with <code>@testsetup</code>. To use a function <code>my_function</code> of a module <code>MySetup</code> in a <code>@testitem</code>, you can import it with</p><pre><code class="language-julia hljs">using .MySetup: my_function</code></pre><p>It is also possible to use functions from another module within a module. But for this the order of the modules in the <code>setup</code> keyword of <code>@testitem</code> is important: you have to add the module that will be used before the module using it. From the latter, you can then use it with</p><pre><code class="language-julia hljs">using ..MySetup: my_function</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../setup/">« Developer setup</a><a class="docs-footer-nextpage" href="../conventions/">Notation and conventions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Thursday 9 October 2025 22:35">Thursday 9 October 2025</span>. Using Julia version 1.12.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
